<%= tag.div class: "card p-2 general-related-tags-column hidden", "x-data": { collapsed: collapsed }.to_json do %>
  <div class="flex justify-between">
    <h6 class="inline-flex gap-1 items-center">
      <%= spinner_icon(class: "text-muted align-middle invisible", "x-cloak": true, "x-bind:class": '{ invisible: !$store.relatedTags.loading }') %>

      Related:
      <%= link_to "javascript:void(0)", class: "related-tags-button" do %>
        <span class="related-tags-current-tag"></span>
      <% end %>
    </h6>

    <span>
      <a href="javascript:void(0)" class="related-tags-button inline-block align-top w-4" x-cloak x-on:click="collapsed = false" x-show="collapsed"><%= chevron_down_icon(class: "rotate-180") %></a>
      <a href="javascript:void(0)" class="inline-block align-top w-4" x-cloak x-on:click="collapsed = true" x-show="!collapsed"><%= chevron_down_icon %></a>
    </span>
  </div>

  <% if related_tags.present? && related_tags.tag.present? %>
    <%= render(TabPanelComponent.new(classes: "mt-1 button-group-tab-panel", tab_list_classes: "my-2", html: { "x-show": "!collapsed" }) do |t| %>
      <% t.panel("All", active: true, classes: "ml-4 button-xs") do %>
        <%= render "related_tags/tag_column", tags: related_tags.similar_tags.map(&:name), class: "all-related-tags-column", title: nil %>
      <% end %>

      <% related_tags.related_categories.reverse.each do |category| %>
        <% t.panel(TagCategory.reverse_mapping[category].upcase_first.pluralize, classes: "button-xs") do %>
          <%= render "related_tags/tag_column", tags: related_tags.frequent_tags(categories: [category]).map(&:name), title: nil %>
        <% end %>
      <% end %>

      <% if related_tags.wiki_page_tags.present? %>
        <% t.panel("Wiki", classes: "button-xs") do %>
          <%= render "related_tags/tag_column", tags: related_tags.wiki_page_tags, class: "wiki-related-tags-column", title: nil %>
        <% end %>
      <% end %>
    <% end) %>
  <% end %>
<% end %>
